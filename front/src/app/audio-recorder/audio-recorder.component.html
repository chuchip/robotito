<div class="overlay" *ngIf="isLoading">
  <mat-spinner></mat-spinner>
</div>


<div class="container">
  <div class="system" *ngIf="response_back!=''">{{response_back}}</div>
  <!-- Body of the page when I will show the conversation  -->
  <div  #conversation class="conversation">
    <div class="line" *ngFor="let line_chat of chat_history; let i = index">
      <button class="speaker-btn" (click)="speak_aloud_response(i)"> <span
          class="material-icons">volume_up</span></button>
      <span class="line-text">
        <span class="material-icons" style="color: blue">{{line_chat.type=='H'?"face":"smart_toy" }}</span>
        <span [innerHTML]=" line_chat.msg"> </span>
      </span>
    </div>
  </div>
  <!-- Input and controls -->
  <div class='input'>
    <div class="head">
      <input #inputField type="text" [(ngModel)]="inputText" style="width: 500px;" (keydown.enter)="sendData()" (keydown.F1)="toggleRecording()"
        placeholder="Type and press Enter">
      <button class="stop-button" (click)="speak_aloud()" matTooltip="Speak Input text">
        <span class="material-icons">volume_up</span>
      </button>

      <button class="stop-button" (click)="toggleRecording()" matTooltip="Record voice (F1)">
        <span class="material-icons">{{ isRecording ? 'stop' : 'mic' }}</span>
      </button>
      <input class="check-option" type="checkbox" [(ngModel)]="sw_talk_response"
        matTooltip="Reproduce Sound Automatically"> Talk
      <input class="check-option" type="checkbox" [(ngModel)]="sw_send_audio" matTooltip="Send Audio as Text"> STT
      <select [(ngModel)]="selectedValue" (change)="onChangeLanguage()">
        <option *ngFor="let option of options" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
      <button class="stop-button" (click)="stopAudio()" matTooltip="Stop Talk">
        <mat-icon>stop</mat-icon>
      </button>
      <button class="stop-button" (click)="setVisibleContext()" matTooltip="Set Context">
        <mat-icon>menu_book</mat-icon>
      </button>
      <button class="stop-button" (click)="clearConversation()" matTooltip="Clear conversation">
        <mat-icon>refresh</mat-icon>
      </button>

    </div>
  </div>
  <!-- Output of record -->
  <div *ngIf="showRecord" class="output_record">
    <button class="stop-btn" (click)="copy_to_input()"> <span class="material-icons">content_copy</span></button>
    <input #record_text type="text" [(ngModel)]="audio_to_text" style="width: 500px;" (keydown.enter)="copy_to_input();sendData()"
    (keydown.F1)="toggleRecording()" (keydown.esc)="focus_input()" >
  
  </div>
  <!-- to put a context to the conversation -->
  <div class="context" *ngIf="showContext">
    <textarea #context style="width: 98%;height: 90px; font-size: 10px;" (keydown.enter)="send_context($event)"
      (keydown.esc)="showContext=false" [value]="contextValue" placeholder="Type an context..."></textarea>
  </div>

