<div class="overlay" *ngIf="isLoading">
  <mat-spinner></mat-spinner>
</div>

<div class="system" *ngIf="response_back!=''">{{response_back}}</div>
<div class="container">  
  <!-- Body of the page when I will show the conversation  -->
  <div  #conversation class="conversation">
    <div class="line" *ngFor="let line_chat of chat_history; let i = index">
      <div class="buttons-conversation">
        <button  (click)="speak_aloud_response(i)"> <span class="material-icons">volume_up</span></button>        
        <span class="material-icons" style="color: blue">{{line_chat.type=='H'?"face":"smart_toy" }}</span>
      </div>
      <span class="line-text">       
        <span [innerHTML]="toHtml(line_chat.msg)"> </span>
      </span>
    </div>
  </div>
  <div class="spacer"></div>
  <!-- Input and controls -->
  <div class='input'>
    <div class="head">
      <span class="name_user" >User: <br>{{user}}</span>
      <input #inputField type="text" [(ngModel)]="inputText" style="width: 500px;" (keydown.enter)="sendData()" (keydown.F2)="toggleRecording()"
        placeholder="Type and press Enter">
      <button class="stop-button" (click)="speak_aloud()" matTooltip="Speak Input text">
        <span class="material-icons">volume_up</span>
      </button>

      <button class="stop-button" (click)="toggleRecording()" matTooltip="Record voice (F1)">
        <span class="material-icons">{{ isRecording ? 'stop' : 'mic' }}</span>
      </button>
      <button class="stop-button" (click)="stopAudio()" matTooltip="Stop Talk">
        <span class="material-icons">stop</span>
      </button>
      <button class="stop-button" (click)="setVisibleContext()" matTooltip="Set Context">
        <span class="material-icons">menu_book</span>
      </button>
      <button class="stop-button" (click)="clearConversation()" matTooltip="Clear conversation">
        <span class="material-icons">refresh</span>
      </button>
      <span class="check-option" ><input type="checkbox" [(ngModel)]="sw_talk_response"
        matTooltip="Reproduce Sound Automatically"> Talk</span>
      <span class="check-option" ><input type="checkbox" [(ngModel)]="sw_send_audio" matTooltip="Send Audio as Text inmediately">
         STT</span>
      <select [(ngModel)]="selectedValue" (change)="onChangeLanguage()">
        <option *ngFor="let option of options" [value]="option.value">
          {{ option.label }}
        </option>
      </select>     
    </div>
  </div>
  <!-- Output of record -->
  <div *ngIf="showRecord" class="output_record">
    <button class="stop-btn" (click)="copy_to_input()"> <span class="material-icons">content_copy</span></button>
    <input #record_text type="text" [(ngModel)]="audio_to_text" style="width: 500px;" (keydown.enter)="copy_to_input();sendData()"
    (keydown.F2)="toggleRecording()" (keydown.esc)="focus_input()" >
  
  </div>
  <!-- to put a context to the conversation -->
  <div class="context" *ngIf="showContext">
    <div class="line" *ngFor="let context of contexts; let i = index">
       {{context['label']}} {{context['context']}}

    </div>    
    <textarea #context style="width: 98%;height: 90px; font-size: 10px;" (keydown.enter)="send_context($event)"
      (keydown.esc)="showContext=false" [value]="contextValue" placeholder="Type an context..."></textarea>
  </div>

